---
import { getLangFromUrl } from "../i18n/utils";
const lang = getLangFromUrl(Astro.url);
const currentPath = Astro.url.pathname.substring(4);
let otherLang;
if (lang == "nl") {
  otherLang = "en";
} else {
  otherLang = "nl";
}
let otherURL = "/" + otherLang + "/" + currentPath;

// import primaryNav from "../../public/data/navigation_data.json";
import Icon from "./astro/Icon.astro";
import AtomLogo from "./Atoms/AtomLogo.astro";
// Convert the object to a JSON string
// const primaryNavJSON = JSON.stringify(primaryNav);

const { hasHero } = Astro.props;
let { Theme } = Astro.props;
if (!Theme) {
  Theme = "light";
}

// let { showMsgBar } = Astro.props;
---

<div id="NavBarMobile" class="NavBarMobile" data-theme={Theme}>
  <header
    {/*...ariaProperties*/}
    class="masthead masthead-mobile NavBarMobile__header"
    :class="{ 'NavBar--isScrolled': isScrolled, 'NavBar--isOpen': isNavVisible }"
    id="masthead-mobile"
    {/*data-theme={Theme}*/}
    {/*data-show-topmessagebar={showMsgBar}*/}
    v-cloak
  >
    <div class="NavBarMobile__top" ref="NavBarMobile__top">
      <AtomLogo url="/" icon="logo-henk-solo" width="140" height="32" />
      <!-- cart icon/button -->
      <a href="/en/cart/list" class="NavBarMobile__top-link">
        <!-- icon cart here -->
        <Icon class="sh-atom-icon" width="24" height="24" name="icon-cart" />
        Cart
      </a>
      <!-- hamburger button -->
      <hamburger-button @click="toggleNav"></hamburger-button>
    </div>
    <nav
      :class="{ 'mobile-nav': true, 'active': isNavVisible }"
      class="NavBarMobile__nav"
    >
      <button
        v-if="currentLevel > 1"
        @click="navigateToPreviousLevel"
        class="sh-atom-button NavBarMobile__button NavBarMobile__button-back"
        :class="{ reverse: isGoingBack }"
        data-style="plain"
      >
        <!-- arrow back -->
        <Icon
          class="sh-atom-icon NavBarMobile__icon-back"
          width="16"
          height="16"
          name="icon-arrow-left-nav-back"
        />
        Back
      </button>
      <ol class="NavBarMobile__list" :key="currentLevel">
        <li
          v-for="(item, index) in (currentLevel === 1 ? navigationData : currentItems)"
          :key="item.title"
          class="NavBarMobile__list-item"
          :style="{ 'animation-delay': index * 0.15 + 's', opacity: 0 }"
        >
          <span
            v-if="item.childrenData"
            class="NavBarMobile__button NavBarMobile__button-next-level"
            @click="handleMobileNavItemClick(item)"
          >
            [[ item.navTitle ]]
            <Icon
              class="sh-atom-icon"
              width="16"
              height="16"
              name="icon-arrow-right-nav-next"
            />
          </span>
          <a v-else :href="item.url" class="page-link"> [[ item.navTitle ]]</a>
        </li>
        <li
          v-if="currentLevel === 1"
          class="NavBarMobile__list-item NavBarMobile__utils-list-container"
        >
          <ul class="NavBarMobile__utils-list --direction-horizontal">
            <li class="NavBarMobile__list-item NavBarMobile__utils-list-item">
              <a href="/en/stores" class="page-link">
                <!--search-->
                Stores
                <Icon
                  class="sh-atom-icon"
                  width="16"
                  height="16"
                  name="icon-location"
                />
              </a>
            </li>
            <li class="NavBarMobile__list-item NavBarMobile__utils-list-item">
              <a href="/en/search" class="page-link">
                <!--search-->
                Search
                <Icon
                  class="sh-atom-icon"
                  width="16"
                  height="16"
                  name="icon-search"
                />
              </a>
            </li>
            <li class="NavBarMobile__list-item NavBarMobile__utils-list-item">
              <!-- langSwitch -->
              <lang-switch data-url={otherURL} title={otherURL} lang={lang}>
              </lang-switch>
            </li>
          </ul>
        </li>
      </ol>
    </nav>
  </header>
</div>
<div id="pixel-to-watch-mobile"></div>
