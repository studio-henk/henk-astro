---
const navLinks = [
    {
        name: 'Shop',
        url: '#Shop',
        style: 'transparent',
        submenu: [
            {
                name: 'Tables',
                url: '#tables',
                submenu: [
                    {
                        name: 'All Tables',
                        url: '#tables',
                        submenu: null,
                    },
                    {
                        name: 'Dining Tables',
                        url: '#dining-tables',
                        submenu: null,
                    },
                    {
                        name: 'Coffee Tables',
                        url: '#coffee-tables',
                        submenu: null,
                    },
                    {
                        name: 'Home Desks',
                        url: '#home-desks',
                        submenu: null,
                    },
                    {
                        name: 'Bistro Tables',
                        url: '#bistro-tables',
                        submenu: null,
                    }
                ]
            },
            {
                name: 'Chairs',
                url: '#chairs',
                submenu: [
                    {
                        name: 'All Chairs',
                        url: '#all-chairs',
                        submenu: null,
                    },
                    {
                        name: 'Dining Chairs',
                        url: '#dining-chairs',
                        submenu: null,
                    }
                ]
            },
            {
                name: 'Sofas',
                url: '#sofas',
                submenu: null,
            },
            {
                name: 'Cabinets',
                url: '#cabinets',
                submenu: null,
            },
            {
                name: 'Accessories',
                url: '#accessories',
                submenu: null,
            },
            {
                name: 'Outdoor',
                url: '/en/outdoor',
                submenu: null,
            }
        ]
    },
    {
        name: 'Configurator',
        url: '#Configurator',
        style: 'transparent',
        submenu: null,
    },
    {
        name: 'Samples',
        url: '#Samples',
        style: 'transparent',
        submenu: null,
    },
    {
        name: 'Visit',
        url: '#Visit',
        style: 'transparent',
        submenu: [
            {
                name: 'Our Stores',
                url: '/en/shops',
                submenu: null,
            },
            {
                name: 'Interior advice',
                url: '/en/advice',
                submenu: null,
            }
        ]
    },
    {
        name: 'Inspiration',
        url: '#',
        style: 'transparent',
        submenu: null,
    },
    {
        name: 'About',
        url: '/en/about-us',
        style: 'transparent',
        submenu: null,
    },
    {
        name: 'Search',
        url: '#',
        style: 'transparent',
        submenu: null,
    },
    {
        name: 'Language',
        url: '#',
        style: 'transparent',
        submenu: null,
    },
    {
        name: 'cart-badge',
        url: '#',
        style: 'transparent',
        submenu: null,
    }
]
---
<nav class="main-navigation" id="main-navigation">
    <ul class="main-navigation__link-list" data-nav-level="1">
        {
            navLinks.map((link, index) => (
                <li role="none" class={ link.submenu ? '--has-submenu' : '' }>
                    <a class="" href={link.url}>{link.name} { link.submenu ? '>' : '' }</a>
                    {
                        (link.submenu != null) &&
                        <ul class="submenu" id={link.name} data-nav-level={index + 2}>
                            <li><a href="#back" class="--back">Back</a></li>
                            {
                                link.submenu.map(subitem => (
                                    <li class={ subitem.submenu ? '--has-submenu' : '' }>
                                        <a href={subitem.url}>{subitem.name}</a>
                                        {
                                            (subitem.submenu != null) &&
                                            <ul class="subsubmenu" data-nav-level={index + 3}>
                                                <li><a href="#back" class="--back">Back</a></li>
                                                {
                                                    subitem.submenu.map(subsubitem => (
                                                        <li>{subsubitem.name}</li>
                                                    ))
                                                }
                                            </ul>
                                        }
                                    </li>
                                ))
                            }
                        </ul>
                    }
                </li>
            ))
        }
    </ul>
</nav>
<script>
    const masthead = document.querySelector('#masthead');
    const navBtn = document.querySelector('#menu-btn');
    const rootElement = document.documentElement;
    navBtn.addEventListener('click', () => {
        navBtn.setAttribute('aria-expanded', navBtn.getAttribute('aria-expanded') === 'false' ? 'true' : 'false')
        // toggle class on html?
        rootElement.classList.toggle('--menu-open');

        if (rootElement.classList.contains('--showingLevel2')) {
            rootElement.classList.remove('--showingLevel2');
        } else if (rootElement.classList.contains('--showingLevel3')) {
            rootElement.classList.remove('--showingLevel3');
        }
    })

    const subMenuLinks = document.querySelectorAll('.--has-submenu > a');
    // add eventlistener for each
    subMenuLinks.forEach((smLink) => {
        smLink.addEventListener('click', () => {
            event.preventDefault();
            rootElement.classList.add('--showingLevel2');
            const openedSubs = document.querySelectorAll('.--clickedToOpen');
            openedSubs.forEach( (item) => {
                item.classList.remove('--clickedToOpen');
            })
            event.currentTarget.classList.add('--clickedToOpen');
            event.target.classList.toggle('--active-link');
            event.currentTarget.nextElementSibling.classList.add('--active-submenu');
            console.log(event.currentTarget);
        })
    });

    function openActiveSubmenu (currentActiveLink) {
        // alert(currentActiveLink.innerText);
        // activate next element with class submenu
        // currentActiveLink.nextElementSibling.style.display = 'block';
        currentActiveLink.nextElementSibling.classList.add('--active-submenu');
        // close any others?

        // move total list 100vw to the left
        moveMainNavLeft();
    }

    function moveMainNavLeft () {
        const mainNav = masthead.querySelector('#main-navigation');
        // mainNav.style('translateX', '-100vw');
        // mainNav.setAttribute("style", "background-color:darkblue;");
        mainNav.setAttribute("style", "transform: translateX(-100vw);");
    }

    function setBackButtonEventHandlers () {
        // addEventListener('click', function(event){
    }

    // Back links (from level 1 submenu to main level)
    const BackLinks = document.querySelectorAll('.--has-submenu .submenu li > a.--back');
    // console.log(BackLinks);
    BackLinks.forEach((backLink) => {
        backLink.addEventListener('click', () => {
            event.preventDefault();
            console.log('back called');
            // rootElement.classList.add('--submenu-closed');
            // if (rootElement.classList.contains('--submenu-clicked')) {
            //     rootElement.classList.remove('--submenu-clicked');
            // }
            if (rootElement.classList.contains('--showingLevel2')) {
                rootElement.classList.remove('--showingLevel2');
            } else if (rootElement.classList.contains('--showingLevel3')) {
                rootElement.classList.remove('--showingLevel3');
                rootElement.classList.add('--showingLevel2');
            }
            // remove any leftover --clickedToOpen classes
            // this class is used to show the correct sub menu
            // example
            // shop -> tables
            // visit -> our stores
            // they are on top of each other, otherwise last one will always show.
            /*const openedSubs = document.querySelectorAll('.--clickedToOpen');
            openedSubs.forEach( (item) => {
                item.classList.remove('--clickedToOpen');
            })*/
            //event.target.classList.toggle('--active-link');
            const activeLinks = masthead.querySelectorAll('.--active-link');
            activeLinks.forEach((activeLink) => {
                //console.log(activeLink.classList);
                activeLink.classList.remove('--active-link');
                activeLink.nextElementSibling.classList.remove('--active-submenu');
            })
        })
    });

    /* level 2 */
    /*const level2Links = document.querySelectorAll('.--clickToOpenLevel2');
    // add eventlistener for each
    level2Links.forEach((smLink) => {
        smLink.addEventListener('click', () => {
            event.preventDefault();
            rootElement.classList.add('--submenu-clicked');
            rootElement.classList.add('--showingLevel2');
            if (rootElement.classList.contains('--submenu-closed')) {
                rootElement.classList.remove('--submenu-closed');
            }
            event.currentTarget.classList.add('--clickedToOpenLevel2');
            console.log(event.currentTarget);
        })
    });*/

    /* level 3 subsubmenu links */
    const level2Links = document.querySelectorAll('.--has-submenu .--has-submenu > a');
    // add eventlistener for each
    level2Links.forEach((subsmLink) => {
        subsmLink.addEventListener('click', () => {
            event.preventDefault();
            rootElement.classList.remove('--showingLevel2');
            rootElement.classList.add('--showingLevel3');
            const openedSubs = document.querySelectorAll('.--clickedToShowL3Sub');
            openedSubs.forEach( (item) => {
                item.classList.remove('--clickedToShowL3Sub');
            })
            event.currentTarget.classList.add('--clickedToShowL3Sub');
            console.log(event.currentTarget);
        })
    });


    /* level 3 subsubmenu links */
    const subsubMenuLinks = document.querySelectorAll('.cmp-nav-level4');
    // add eventlistener for each
    subsubMenuLinks.forEach((subsmLink) => {
        subsmLink.addEventListener('click', () => {
            event.preventDefault();
            rootElement.classList.add('--navbar-level3-shown');
            /*if (rootElement.classList.contains('&#45;&#45;submenu-closed')) {
                rootElement.classList.remove('&#45;&#45;submenu-closed');
            }*/
            /*event.currentTarget.classList.add('&#45;&#45;clickedToOpen');*/
            console.log(event.currentTarget);
        })
    });
</script>