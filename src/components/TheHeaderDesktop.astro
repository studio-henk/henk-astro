---
// import NavBarDesktop from '../components/NavBar3Desktop.astro';
import Icon from "./Icon.astro";
import AtomLogo from "./Atoms/AtomLogo.astro";
import AtomBadge from "./Atoms/AtomBadge.astro";
---
<header class="masthead-desktop nav-down" id="masthead-desktop">
    <div class="primary-nav-container">
        <AtomLogo
            url="/"
            icon="henk-logo"
            width="163"
            height="14"
        />
        <nav class="primary-nav">
            <a id="pn-shop" class="hoverlink" href="#shop" data-target="shop">Shop</a>
            <!--<span id="pn-shop" class="hoverlink" data-target="shop">Shop</span>-->
            <a href="/en/configurator">Configurator</a>
            <a href="/en/samples">Samples</a>
            <a id="pn-visit" class="hoverlink" href="#visit" data-target="visit">Visit</a>
            <a id="pn-inspiration" class="hoverlink" href="#inspiration" data-target="inspiration">Inspiration</a>
            <a href="/en/about-us">About</a>
        </nav>
        <nav class="utilities-nav">
            <a href="#search">Search</a>
            <a href="#language">Language</a>
            <!--<span class="tmp-badge">10</span>-->
            <AtomBadge isLink={true} badgeNumber="6" />
        </nav>
    </div>
    <!-- submenu shop -->
    <div class="submenu" id="mn-shop" style="xopacity: 1;">
        <div class="submenu__grid">
            <div class="submenu__grid-item">
                <small style="line-height: 14px; letter-spacing: normal;">Products</small>
                <ul class="submenu__ul">
                    <li><a class="submenu__link" href="#tables">Tables</a></li>
                    <li><a class="submenu__link" href="#chairs">Chairs</a></li>
                    <li><a class="submenu__link" href="#sofas">Sofas</a></li>
                    <li><a class="submenu__link" href="#cabinets">Cabinets</a></li>
                    <li><a class="submenu__link" href="#accessories">Accessories</a></li>
                    <li><a class="submenu__link" href="#outdoor">Outdoor</a></li>
                </ul>
            </div>
            <div class="submenu__grid-item">
                <a class="submenu__item-link" href="#">
                    <div class="submenu__item-images">
                        <img
                            src="https://picsum.photos/id/238/556/722"
                            class="submenu__item-image"
                            alt=""
                            width="278"
                            height="361"
                        >
                        <!--<img src="https://picsum.photos/id/239/556/722" class="submenu__item-image-hover" alt="">-->
                        <!--<img
                            src="https://placehold.co/556x722"
                            class="submenu__item-image"
                            alt="placeholder image"
                            width="278"
                            height="361"
                        >-->
                    </div>
                    <p class="submenu__item-title">Title here</p>
                </a>
            </div>
            <div class="submenu__grid-item">
                <a class="submenu__item-link" href="#">
                    <div class="submenu__item-images">
                        <img
                            src="https://placehold.co/556x722"
                            class="submenu__item-image"
                            alt="placeholder image"
                            width="278"
                            height="361"
                        >
                    </div>
                    <p class="submenu__item-title">Title here</p>
                </a>
            </div>
            <div class="submenu__grid-item">
                <a class="submenu__item-link" href="#">
                    <div class="submenu__item-images">
                        <img
                            src="https://placehold.co/556x722"
                            class="submenu__item-image"
                            alt="placeholder image"
                            width="278"
                            height="361"
                        >
                    </div>
                    <p class="submenu__item-title">Title here</p>
                </a>
            </div>
            <div class="submenu__grid-item">
                <a class="submenu__item-link" href="#">
                    <div class="submenu__item-images">
                        <img
                            src="https://placehold.co/556x722"
                            class="submenu__item-image"
                            alt="placeholder image"
                            width="278"
                            height="361"
                        >
                    </div>
                    <p class="submenu__item-title">Title here</p>
                </a>
            </div>
        </div>
    </div>
    <div class="submenu" id="mn-visit">
        <div class="submenu__grid">
            <div class="submenu__grid-item">
                <small style="line-height: 14px; letter-spacing: normal;">Visit</small>
                <ul class="submenu__ul">
                    <li><a class="submenu__link" href="#stores">Our stores</a></li>
                    <li><a class="submenu__link" href="#etc">Interior advice</a></li>
                </ul>
            </div>
            <div class="submenu__grid-item">
                <a class="submenu__item-link" href="#">
                    <div class="submenu__item-images">
                        <img
                            src="https://picsum.photos/id/230/556/722"
                            class="submenu__item-image"
                            alt=""
                            width="278"
                            height="361"
                        >
                        <!--<img src="https://picsum.photos/id/239/556/722" class="submenu__item-image-hover" alt="">-->
                        <!--<img
                            src="https://placehold.co/556x722"
                            class="submenu__item-image"
                            alt="placeholder image"
                            width="278"
                            height="361"
                        >-->
                    </div>
                    <p class="submenu__item-title">Title here</p>
                </a>
            </div>
            <div class="submenu__grid-item">
                <a class="submenu__item-link" href="#">
                    <div class="submenu__item-images">
                        <img
                            src="https://placehold.co/556x722"
                            class="submenu__item-image"
                            alt="placeholder image"
                            width="278"
                            height="361"
                        >
                    </div>
                    <p class="submenu__item-title">Title here</p>
                </a>
            </div>
            <div class="submenu__grid-item">
                <a class="submenu__item-link" href="#">
                    <div class="submenu__item-images">
                        <img
                            src="https://placehold.co/556x722"
                            class="submenu__item-image"
                            alt="placeholder image"
                            width="278"
                            height="361"
                        >
                    </div>
                    <p class="submenu__item-title">Title here</p>
                </a>
            </div>
            <div class="submenu__grid-item">
                <a class="submenu__item-link" href="#">
                    <div class="submenu__item-images">
                        <img
                            src="https://placehold.co/556x722"
                            class="submenu__item-image"
                            alt="placeholder image"
                            width="278"
                            height="361"
                        >
                    </div>
                    <p class="submenu__item-title">Title here</p>
                </a>
            </div>
        </div>
    </div>
    <div class="submenu" id="mn-inspiration">
        <div class="submenu__grid">
            <div class="submenu__grid-item">
                <small style="line-height: 14px; letter-spacing: normal;">Inspiration</small>
                <ul class="submenu__ul">
                    <li><a class="submenu__link" href="/en/blogs">Stories</a></li>
                    <li><a class="submenu__link" href="/en/projects">Projects</a></li>
                </ul>
            </div>
            <div class="submenu__grid-item">
                <a class="submenu__item-link" href="#">
                    <div class="submenu__item-images">
                        <img
                            src="https://picsum.photos/id/222/556/722"
                            class="submenu__item-image"
                            alt=""
                            width="278"
                            height="361"
                        >
                        <!--<img src="https://picsum.photos/id/239/556/722" class="submenu__item-image-hover" alt="">-->
                        <!--<img
                            src="https://placehold.co/556x722"
                            class="submenu__item-image"
                            alt="placeholder image"
                            width="278"
                            height="361"
                        >-->
                    </div>
                    <p class="submenu__item-title">Title here</p>
                </a>
            </div>
            <div class="submenu__grid-item">
                <a class="submenu__item-link" href="#">
                    <div class="submenu__item-images">
                        <img
                            src="https://placehold.co/556x722"
                            class="submenu__item-image"
                            alt="placeholder image"
                            width="278"
                            height="361"
                        >
                    </div>
                    <p class="submenu__item-title">Title here</p>
                </a>
            </div>
            <div class="submenu__grid-item">
                <a class="submenu__item-link" href="#">
                    <div class="submenu__item-images">
                        <img
                            src="https://placehold.co/556x722"
                            class="submenu__item-image"
                            alt="placeholder image"
                            width="278"
                            height="361"
                        >
                    </div>
                    <p class="submenu__item-title">Title here</p>
                </a>
            </div>
            <div class="submenu__grid-item">
                <a class="submenu__item-link" href="#">
                    <div class="submenu__item-images">
                        <img
                            src="https://placehold.co/556x722"
                            class="submenu__item-image"
                            alt="placeholder image"
                            width="278"
                            height="361"
                        >
                    </div>
                    <p class="submenu__item-title">Title here</p>
                </a>
            </div>
        </div>
    </div>
</header>
<style is:global>
    @media only screen and (min-width: 1512px) {

    @keyframes fade-in {
        0% {
            opacity: 0;
            background-color: transparent;
        }
        100% {
            opacity: 1;
            background-color: var(--color-accent1);
        }
    }

    @keyframes fade-out {
        0% {
            opacity: 1;
            background-color: var(--color-accent1);
        }
        100% {
            opacity: 0;
            background-color: transparent;
        }
    }

    .masthead-desktop * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
    }

    .masthead-desktop {
        box-sizing: border-box;
        position: fixed;
        top: 0;
        left: 0;
        z-index: 999;
        width: 100%;
        padding: 35px 28px;
        mix-blend-mode: difference;
        transition: opacity .3s ease-out;
    }

    .--desktop-menu-open .masthead-desktop {
        mix-blend-mode: unset;
    }

    .primary-nav-container {
        display: flex;
        justify-content: space-between;
        align-items: center;
        z-index: 9;
        position: relative;
        mix-blend-mode: difference;
    }

    .primary-nav-container .primary-nav {
        display: flex;
        gap: 42px;
    }

    .utilities-nav {
        display: flex;
        gap: 42px;
    }

    .masthead-desktop .atom-logo {
        /* margin: 0 auto 0 0; */
        justify-self: flex-start;
        --color-text-logo: var(--color-white);
    }

    .masthead-desktop .atom-badge {
        /*--color-background-badge: var(--color-white);
        --color-text-badge: var(--color-henk-black);*/
        --color-text-badge: var(--color-henk-black);
    }

    .masthead-desktop nav a,
    .primary-nav-container .primary-nav span {

    }

    .masthead-desktop nav a:hover {
        /*text-decoration: underline;*/
    }

    .masthead-desktop .primary-nav a,
    .masthead-desktop .utilities-nav a:not(.atom-badge) {
        color: #fff;
        text-decoration: none;
    }

    .masthead-desktop .primary-nav .--hoverlink-active {
        text-decoration-line: underline;
    }

    .masthead-desktop .submenu {
        background-color: var(--color-accent1);
        position: absolute;
        top: 0;
        left: 0;
        opacity: 0;
        z-index: 4;
        pointer-events: none;
        /*transition: opacity 0.3s ease-in-out;*/
        width: 100%;
        padding: 121px 28px 42px;
    }

    .masthead-desktop .submenu.--submenu-open {
        pointer-events: all;
        opacity: 1;
    }

    .masthead-desktop .submenu.--submenu-open.--submenu-fade-in {
        animation-name: fade-in;
        animation-delay: 0s;
        animation-direction: normal;
        animation-duration: 600ms;
        animation-fill-mode: forwards;
        animation-iteration-count: 1;
        animation-timing-function: ease-in-out;
    }

    .masthead-desktop .submenu.--submenu-open.--submenu-fade-out {
        animation-name: fade-out;
        animation-delay: 0s;
        animation-direction: normal;
        animation-duration: 600ms;
        animation-fill-mode: forwards;
        animation-iteration-count: 1;
        animation-timing-function: ease-in-out;
    }

    .submenu__grid {
        display: grid;
        grid-template-columns: repeat(5, 1fr);
        grid-template-rows: 401px;
        gap: 17px;
        opacity: 0;
        transition: opacity 700ms ease;
    }

    .--submenu-open .submenu__grid {
        opacity: 1;
    }

    .submenu__grid-item {
        /*background-color: pink;*/
    }

    .submenu__ul {
        list-style: none;
    }

    .submenu__link {
        line-height: 40px;
        text-decoration: none;
    }

    .submenu__item-link {
        display: flex;
        flex-direction: column;
        /*background: blueviolet;*/
        height: 100%;
        text-decoration: none;
    }

    .submenu__item-images {
        position: relative;
        overflow: hidden;
        border-radius: 5px;
    }

    .submenu__item-image {
        transition: all .3s ease-in-out;
        object-fit: cover;
    }

    .submenu__item-link:hover .submenu__item-image {
        transform: scale(1.025);
        border-radius: 5px;
    }

    /*.submenu__item-image + .submenu__item-image-hover {
        opacity: 0;
        z-index: 9;
        position: relative;
    }

    .submenu__item-link:hover .submenu__item-image + .submenu__item-image-hover {
        opacity: 1;
        z-index: 9;
    }*/

    .submenu__item-title {
        line-height: 40px;
        text-decoration-line: underline;
        text-decoration-color: inherit;
        text-decoration-skip-ink: auto;
        text-decoration-thickness: 1px;;
        text-underline-offset: 4px;
        transition: all .3s ease-out;
    }

    .submenu__item-link:hover .submenu__item-title {
        text-decoration-color: red;
    }

    .masthead-desktop *:focus-visible {
        outline: 3px solid deepskyblue;
        outline-offset: 3px;
        background-color: #444;
    }

    @supports not selector(:focus-visible) {
        .masthead-desktop *:focus {
            /* Fallback for browsers without :focus-visible support */
            outline: 3px solid greenyellow;
            outline-offset: 3px;
        }
    }
    }

    @media only screen and (max-width: 1511px) {
        .masthead-desktop {
            display: none;
        }
    }

    .nav-up {
        /*top: -102px;*/
        opacity: 0;
    }
</style>
<script>
    // elements
    const rootElement = document.documentElement;
    const masthead = document.querySelector(".masthead-desktop");
    const primaryNavLinks = document.querySelectorAll(".primary-nav .hoverlink");

    // LISTENERS

    // when mouse leaves masthead-desktop
    masthead.addEventListener("mouseleave", function (e) {
        // console.log("mouse left the masthead-desktop");
        fadeOutSubmenu();
    });

    // primary nav links that have a submenu
    primaryNavLinks.forEach(function (currentElement, currentIndex, listObj) {
        // disable clicking on these
        currentElement.addEventListener("click", function (event) {
            // handlePrimaryLinks(currentElement, event);
            event.preventDefault();
        });

        // set mouse over listener
        currentElement.addEventListener("mouseover", function (event) {
            // console.log("mouseover called on primaryNavLink with ID: " + currentElement.id);
            handlePrimaryLinks(currentElement, event);
        });
    });

    // functions
    function handlePrimaryLinks(currentElement, event) {
        event.preventDefault();
        // check if already open ie has class --hoverlink-active
        if (currentElement.classList.contains("--hoverlink-active")) {
            // console.log("already active");
            return;
        } else {
            const targetSubmenu = currentElement.getAttribute('data-target');
            // console.log("target is: " + targetSubmenu);

            // deactivate any open active link
            const activeLink = masthead.querySelector(".--hoverlink-active");
            if (activeLink != null) {
                // console.log(activeLink);
                activeLink.classList.remove("--hoverlink-active");
            }

            // add class active to current hovered one
            currentElement.classList.add("--hoverlink-active");

            const anyOpenSubmenus = masthead.querySelector(".--submenu-open");
            if (anyOpenSubmenus != null) {
                // console.log(anyOpenSubmenus);
                anyOpenSubmenus.classList.remove("--submenu-open");
            } else {
                fadeInSubmenu(targetSubmenu);
            }

            masthead
                .querySelector("#mn-" + targetSubmenu)
                .classList.add("--submenu-open");
        }
    }

    function fadeInSubmenu(ID) {
        // console.log("fading in submenu with ID: " + ID);
        // add --desktop-menu-open to html element
        masthead.querySelector("#mn-" + ID).classList.add("--submenu-fade-in");
        masthead.querySelector("#mn-" + ID).addEventListener("animationend", fadeInEnded, false);
        rootElement.classList.add("--desktop-menu-open");
    }

    function fadeInEnded() {
        // console.log("fade in ended");
        masthead.querySelector(".--submenu-fade-in").removeEventListener("animationend", fadeInEnded, false);
        masthead.querySelector(".--submenu-fade-in").classList.remove("--submenu-fade-in");
    }

    function fadeOutSubmenu() {
        const currentlyOpenSubmenu = masthead.querySelector(".--submenu-open");
        if (currentlyOpenSubmenu != null) {
            // console.log("fading submenu out");
            masthead.querySelector(".--submenu-open").classList.add("--submenu-fade-out");
            masthead.querySelector(".--submenu-open.--submenu-fade-out").addEventListener("animationend", fadeOutEnded, false);
        } else {
            // console.log("nothing to fade out, no submenu is open.");
            return;
        }
    }

    function fadeOutEnded() {
        // console.log("fade out ended");
        masthead.querySelector(".--submenu-fade-out").removeEventListener("animationend", fadeOutEnded, false);
        masthead.querySelector(".--submenu-fade-out").classList.remove("--submenu-fade-out");
        masthead.querySelector(".--submenu-open").classList.remove("--submenu-open");
        masthead.querySelector(".--hoverlink-active").classList.remove("--hoverlink-active");
        rootElement.classList.remove("--desktop-menu-open");
    }
</script>
<script is:inline src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
<script is:inline>
    // Hide Header on on scroll down
    var didScroll;
    var lastScrollTop = 0;
    var delta = 150;
    var navbarHeight = $('.masthead-desktop').outerHeight();
    console.log(navbarHeight);

    $(window).scroll(function(event){
        didScroll = true;
    });

    setInterval(function() {
        if (didScroll) {
            hasScrolled();
            didScroll = false;
        }
    }, 250);

    function hasScrolled() {
        var st = $(this).scrollTop();

        // Make sure they scroll more than delta
        if(Math.abs(lastScrollTop - st) <= delta)
            return;

        // If they scrolled down and are past the navbar, add class .nav-up.
        // This is necessary so you never see what is "behind" the navbar.
        if (st > lastScrollTop && st > navbarHeight){
            // Scroll Down
            $('header').removeClass('nav-down').addClass('nav-up');
        } else {
            // Scroll Up
            if(st + $(window).height() < $(document).height()) {
                $('header').removeClass('nav-up').addClass('nav-down');
            }
        }

        lastScrollTop = st;
    }
</script>